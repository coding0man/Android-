#android 6.0è¿è¡Œæ—¶æƒé™
Android ä¸­çš„æƒé™åœ¨6.0ï¼ˆAPI23ï¼‰ä¹‹å‰ä¸€ç›´æ˜¯åœ¨å®‰è£…åº”ç”¨çš„æ—¶å€™ä¸€æ¬¡æ€§æˆäºˆçš„ï¼Œè¦ä¸ä¸å®‰è£…æ­¤è½¯ä»¶ï¼Œè¦ä¹ˆæ¥å—æ­¤è½¯ä»¶ç”³è¯·çš„æ‰€æœ‰æƒé™ã€‚6.0ä¹‹åï¼ŒGoogleæ›´æ”¹äº†æƒé™çš„æˆäºˆæ–¹å¼ï¼Œç”¨æˆ·åœ¨å®‰è£…æ—¶å¯ä»¥é€‰æ‹©æˆäºˆæˆ–è€…ä¸æˆäºˆåº”ç”¨ç”³è¯·çš„æƒé™ï¼Œåˆ°éœ€è¦ä½¿ç”¨æ­¤æƒé™çš„æ—¶å€™å†å»å‘ç”¨æˆ·ç”³è¯·ã€‚
##æƒé™çš„ä¸¤ç§ç±»å‹
- ###æ™®é€šæƒé™  

	> æ™®é€šæƒé™æŒ‡çš„æ˜¯é‚£äº›ä¸æ¶‰åŠç”¨æˆ·éšç§çš„ä¸€äº›æƒé™ï¼Œæ¯”å¦‚è¿æ¥ç½‘ç»œï¼Œè¯»å–ç½‘ç»œçŠ¶æ€ï¼Œæ¯”å¦‚å»ç³»ç»Ÿç›¸å†Œé€‰æ‹©å›¾ç‰‡ï¼Œå†æ¯”å¦‚ã€‚  
	å¦‚æœåº”ç”¨å£°æ˜å…¶éœ€è¦æ­£å¸¸æƒé™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘åº”ç”¨æˆäºˆè¯¥æƒé™ï¼Œè€Œä¸éœ€è¦åº”ç”¨å»å‘ç”¨æˆ·å®æ—¶ç”³è¯·,åŒæ—¶ï¼Œç”¨æˆ·ä¹Ÿæ— æ³•å–æ¶ˆæˆäºˆè¿™äº›æƒé™ã€‚  
	ä¸‹é¢çš„è¿™äº›æƒé™æ˜¯è¢«ç§°ä¸º*æ™®é€šæƒé™*ï¼ˆPROTECTION_NORMALï¼‰çš„
	- ACCESS\_LOCATION_EXTRA\_COMMANDS 
	- ACCESS\_NETWORK_STATE
	- ACCESS\_NOTIFICATION\_POLICY
	- ACCESS\_WIFI\_STATE
	- BLUETOOTH
	- BLUETOOTH\_ADMIN
	- BROADCAST\_STICKY
	- CHANGE\_NETWORK_STATE
	- CHANGE\_WIFI_\MULTICAST\_STATE
	- CHANGE\_WIFI\_STATE
	- DISABLE\_KEYGUARD
	- EXPAND\_STATUS_BAR
	- GET\_PACKAGE\_SIZE
	- INSTALL\_SHORTCUT
	- INTERNET
	- KILL\_BACKGROUND\_PROCESSES
	- MODIFY\_AUDIO\_SETTINGS
	- NFC
	- READ\_SYNC\_SETTINGS
	- READ\_SYNC\_STATS
	- RECEIVE\_BOOT\_COMPLETED
	- REORDER\_TASKS
	- REQUEST\_IGNORE\_BATTERY\_OPTIMIZATIONS
	- REQUEST\_INSTALL\_PACKAGES
	- SET\_ALARM
	- SET\_TIME_ZONE
	- SET\_WALLPAPER
	- SET\_WALLPAPER\_HINTS
	- TRANSMIT\_IR
	- UNINSTALL\_SHORTCUT
	- USE\_FINGERPRINT
	- VIBRATE
	- WAKE\_LOCK
	- WRITE\_SYNC\_SETTINGS
- ###å±é™©æƒé™  

	> å±é™©æƒé™æ¶µç›–åº”ç”¨éœ€è¦æ¶‰åŠç”¨æˆ·éšç§ä¿¡æ¯çš„æ•°æ®æˆ–èµ„æºï¼Œæˆ–è€…å¯èƒ½å¯¹ç”¨æˆ·å­˜å‚¨çš„æ•°æ®æˆ–å…¶ä»–åº”ç”¨çš„æ“ä½œäº§ç”Ÿå½±å“çš„åŒºåŸŸã€‚ä¾‹å¦‚ï¼Œèƒ½å¤Ÿè¯»å–ç”¨æˆ·çš„è”ç³»äººå±äºå±é™©æƒé™,æ‹¨æ‰“ç”µè¯å±äºå±é™©æƒé™ï¼Œè·å–å®šä½ä¿¡æ¯å±äºå±é™©æƒé™...å¦‚æœåº”ç”¨å£°æ˜å…¶éœ€è¦å±é™©æƒé™ï¼Œåˆ™ç”¨æˆ·å¿…é¡»æ˜ç¡®å‘åº”ç”¨æˆäºˆè¯¥æƒé™ã€‚è¿™å°±éœ€è¦åŠ¨æ€å‘ç”¨æˆ·ç”³è¯·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„è¿è¡Œæ—¶æƒé™ç”³è¯·ã€‚  
	è¿™é‡Œè¿˜æœ‰ä¸€ä»¶äº‹æƒ…è¦è¯´æ˜ï¼Œå°±æ˜¯æƒé™ç»„çš„æ¦‚å¿µã€‚
	####æƒé™ç»„  
		å¦‚æœä¸€ä¸ªåº”ç”¨æ—¢éœ€è¦å†™æ–‡ä»¶ä¹Ÿéœ€è¦è¯»å–æ–‡ä»¶ï¼Œ
		æ—¢éœ€è¦è¯»å–è”ç³»äººä¹Ÿéœ€è¦æ·»åŠ è”ç³»äººï¼Œ
		æ—¢éœ€è¦ç²—ç•¥å®šä½ä¹Ÿéœ€è¦ç²¾ç¡®å®šä½ã€‚
		æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœä¸åœåœ°å‘ç”¨æˆ·å»ç”³è¯·è¿™äº›æƒé™ï¼Œç”¨æˆ·æ˜¯å¦ä¼šå¾ˆåæ„Ÿã€‚
		æ‰€ä»¥ï¼Œä¸ºäº†æä¾›æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œè°·æ­Œçˆ¸çˆ¸åˆ›é€ äº†ä¸€ä¸ªæƒé™ç»„çš„æ¦‚å¿µï¼  
		æƒé™ç»„(è¿™é‡Œåªè¯´å±é™©æƒé™ï¼Œå…¶å®ä»»ä½•æƒé™éƒ½å¯ä»¥å±äºä¸€ä¸ªæƒé™ç»„)ï¼š
		1. ä»»ä½•ä¸€ä¸ªå±é™©æƒé™éƒ½åº”è¯¥å±äºä¸€ä¸ªæƒé™ç»„ï¼Œ
		2. ä¸€æ—¦åº”ç”¨ç”³è¯·çš„æŸä¸ªå±é™©æƒé™è¢«ç”¨æˆ·æˆäºˆï¼Œ
		3. é‚£ä¹ˆè¯¥æƒé™ç»„å†…çš„å…¶ä»–å±é™©æƒé™ä¹Ÿè¢«æˆäºˆã€‚
		äº‹å®ä¸Šï¼Œåœ¨ä½ ç”³è¯·æ‰“ç”µè¯æƒé™çš„æ—¶å€™ï¼Œç³»ç»Ÿå¼¹æ¡†ä¹Ÿæ˜¯åœ¨è¯¢é—®ç”¨æˆ·æ˜¯å¦æˆäºˆè¯¥åº”ç”¨ç”µè¯æƒé™ã€‚ç”µè¯æƒé™çš„æƒé™ç»„æŠ¥é”™æ‰“ç”µè¯æƒé™ã€‚
	####9å¤§æƒé™ç»„
	- CALENDAR
	- CAMERA
	- CONTACTS
	- LOCATION
	- MICROPHONE
	- PHONE
	- SENSORS
	- SMS
	- STORAGE
	
![æƒé™ç»„åŒ…å«çš„æƒé™](https://github.com/coding0man/Android-/blob/master/attachment/Screen%20Shot%202016-12-31%20at%202.07.55%20PM.png)
##æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è¯´è¯´æ€ä¹ˆç”³è¯·è¿è¡Œæ—¶æƒé™
###1. å…ˆè¯´è¯´å‡ ä¸ªç³»ç»Ÿapi  

1. checkSelfPermission
	
	>æ£€æŸ¥æ˜¯å¦æˆäºˆäº†æŸä¸€é¡¹æƒé™,  
	å¦‚æœæƒé™å·²ç»æˆäºˆï¼Œè¿”å›0ï¼Œå¦åˆ™è¿”å›-1
	Determine whether you have been granted a particular permission.
2. shouldShowRequestPermissionRationale
	
	>å½“ä½ æ²¡æœ‰æŸä¸ªæƒé™çš„æ—¶å€™ï¼Œä½ æœ€å¥½æ˜¾ç¤ºä¸€ä¸ªUIç»„ä»¶ï¼Œå‘Šè¯‰ç”¨æˆ·è¿™ä¸ªåº”ç”¨ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªæƒé™ï¼Œå‘Šè¯‰ç”¨æˆ·å¦‚æœæˆäºˆè¯¥æƒé™ä¼šæœ‰å¸¦æ¥ä»€ä¹ˆå¥½å¤„ï¼Œ  
	å¦‚æœæ‚¨çš„æƒé™è¯·æ±‚å·²ç»è¢«æ‹’ç»è¿‡ä¸€æ¬¡ï¼Œè¿”å›true,å¦åˆ™è¿”å›false    
	Gets whether you should show UI with rationale for requesting a permission. You should do this only if you do not have the permission and the context in which the permission is requested does not clearly communicate to the user what would be the benefit from granting this permission.
3. requestPermissions
	
	>å½“æ£€æŸ¥åˆ°ç”¨æˆ·æ²¡æœ‰æˆäºˆæŸé¡¹ä½ éœ€è¦çš„å±é™©æƒé™çš„æ—¶å€™ï¼Œå‘ç”¨æˆ·ç”³è¯·è¯¥æƒé™
	Requests permissions to be granted to this application. These permissions must be requested in your manifest
4. onRequestPermissionsResult

	>è¿™æ˜¯ requestPermissions æ–¹æ³•çš„å›è°ƒï¼Œæ¯æ¬¡è°ƒç”¨requestPermissionséƒ½ä¼šæœ‰ä¸€æ¬¡å›è°ƒ  
	Callback for the result from requesting permissions. This method  is invoked for every call on requestPermissions(String[], int).
	
###2. å†è¯´è¯´æ€ä¹ˆç”¨
è¿™é‡Œé¢æœ‰ä¸€ä¸ªå‘å¾ˆå¤šæ–‡ç« éƒ½æ²¡æœ‰è®²æ˜ç™½ï¼Œæˆ‘ä¹Ÿæ˜¯åœ¨é¡¹ç›®ä¸­é‡åˆ°äº†æ‰æŠŠè¿™ä¸ªé—®é¢˜ç»™ææ¸…æ¥šäº†çš„ã€‚å¤§å¤šæ•°æ–‡ç« çš„ç¤ºä¾‹éƒ½æ˜¯ä»¥Activityä¸ºèƒŒæ™¯è®²çš„ï¼Œåƒæˆ‘è¿™ç§åˆšæ¥è§¦è¿è¡Œæ—¶æƒé™çš„èœé¸Ÿè€Œè¨€ï¼Œå½“ç„¶å°±æ˜¯copyä¸‹åˆ«äººçš„ç”¨æ³•å–½ï¼Œä¸€ä¸å°å¿ƒå°±æ‰è¿›äº†å‘é‡Œã€‚  
è¿™ä¸ªå‘å°±æ˜¯onRequestPermissionsResultæ–¹æ³•æ ¹æœ¬æ²¡è¢«è°ƒç”¨ã€‚[å¸…å“¥ä»¬çœ‹è¿™é‡Œ!](http://stackoverflow.com/questions/32714787/android-m-permissions-onrequestpermissionsresult-not-being-called)
####æ•²é»‘æ¿åˆ’é‡ç‚¹ï¼š
ä¸Šé¢æˆ‘ä»¬è¯´çš„å››ä¸ªç³»ç»Ÿapiä¸­çš„åé¢ä¸‰ä¸ªæ–¹æ³•å…¶å®æ˜¯æœ‰ä¸¤å¥—çš„ï¼ŒActivityä½¿ç”¨ä¸€å¥—ï¼Œ  Fragmentè¦ä½¿ç”¨å¦å¤–ä¸€å¥—ï¼åœ¨Activityä¸­ä½¿ç”¨ActivityCompat.requestPermissionsï¼Œåœ¨Fragmentä¸­ä½¿ç”¨requestPermissions


###3. Talk is simple , show u the code!
æˆ‘ä»¬æ¥çœ‹ç¤ºä¾‹ä»£ç ï¼š  
####çœ‹çœ‹Fragmentæ€ä¹ˆç”¨  
1.æ£€æŸ¥æƒé™

```java
if (ContextCompat.checkSelfPermission(mContext, Manifest.permission.CALL_PHONE)
     	 == PackageManager.PERMISSION_GRANTED) {
    //å·²ç»æˆæƒï¼Œ
}else{
	//æ²¡æœ‰æƒé™
}
```
2.æ˜¾ç¤ºåŸå›   

```java
if(shouldShowRequestPermissionRationale(Manifest.permission.CALL_PHONE){
	//å¦‚æœéœ€è¦æ˜¾ç¤ºè¯·æ±‚æƒé™çš„åŸå›  åœ¨è¿™é‡Œå†™        
} else {
	//è¯·æ±‚æƒé™                  
}
```
3.è¯·æ±‚æƒé™

```java
requestPermissions(new String[]{Manifest.permission.CALL_PHONE},1);
```
4.å¤„ç†å›è°ƒ

```java
@Override
public void onRequestPermissionsResult(int requestCode,String permissions[], int[] grantResults) {
	super.onRequestPermissionsResult(requestCode, permissions, grantResults);
}
```
ä¸€ä¸ªå®Œæ•´çš„Fragmentï¼š

```java
package com.example.francis.demo.simpletest;

import android.Manifest;
import android.content.pm.PackageManager;
import android.os.Bundle;
import android.support.annotation.NonNull;
import android.support.annotation.Nullable;
import android.support.v4.app.Fragment;
import android.support.v4.content.ContextCompat;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;

import com.example.francis.demo.R;

public class RuntimePermissionFragment extends Fragment {
    private final int REQUEST_CODE_CALL_PHONE = 1;

    @Nullable
    @Override
    public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) {
        super.onCreateView(inflater, container, savedInstanceState);
        View view = inflater.inflate(R.layout.fragment_runtime_permission, container, false);
        view.findViewById(R.id.call_button).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (ContextCompat.checkSelfPermission(getActivity(), Manifest.permission.CALL_PHONE) == PackageManager.PERMISSION_GRANTED) {
                    //æ‰“ç”µè¯é€»è¾‘åœ¨å“ªé‡Œå†™
                } else {
                    if (shouldShowRequestPermissionRationale(Manifest.permission.CALL_PHONE)) {
                        //å±•ç¤ºä½ ç»™ç”¨æˆ·çš„è§£é‡Šï¼Œè¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä½ è§‰å¾—ä¸éœ€è¦æˆ–è€…ä½ ä¸æƒ³è§£é‡Šï¼Œé‚£å°±ä¸è¦è§£é‡Šäº† 
                    } else {
                        requestPermissions(new String[]{Manifest.permission.CALL_PHONE}, REQUEST_CODE_CALL_PHONE);
                    }
                }
            }
        });
        return view;
    }

    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == REQUEST_CODE_CALL_PHONE) {
            if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                //æ‰“ç”µè¯æƒé™è¢«æˆäºˆ
                //æ‰“ç”µè¯é€»è¾‘å†™è¿™é‡Œ
            } else {
                //ç”¨æˆ·æ‹’ç»äº†ä½ çš„æ‰“ç”µè¯æƒé™
            }
        }
    }
}
```

####çœ‹çœ‹Activityæ€ä¹ˆç”¨  
1.æ£€æŸ¥æƒé™

```java
if (ContextCompat.checkSelfPermission(mContext, Manifest.permission.CALL_PHONE)
     	 == PackageManager.PERMISSION_GRANTED) {
    //å·²ç»æˆæƒï¼Œ
}else{
	//æ²¡æœ‰æƒé™
}
```
2.æ˜¾ç¤ºåŸå›   

```java
if(ActivityCompat.shouldShowRequestPermissionRationale(Manifest.permission.CALL_PHONE){
	//å¦‚æœéœ€è¦æ˜¾ç¤ºè¯·æ±‚æƒé™çš„åŸå›  åœ¨è¿™é‡Œå†™        
} else {
	//è¯·æ±‚æƒé™                  
}
```
3.è¯·æ±‚æƒé™

```java
ActivityCompat.requestPermissions(new String[]{Manifest.permission.CALL_PHONE},1);
```
4.å¤„ç†å›è°ƒ

```java
@Override
public void onRequestPermissionsResult(int requestCode,String permissions[], int[] grantResults) {
	super.onRequestPermissionsResult(requestCode, permissions, grantResults);
}
```
ä¸€ä¸ªç®€å•Activityç¤ºä¾‹

```java
package com.example.francis.demo.simpletest;

import android.Manifest;
import android.content.Context;
import android.content.pm.PackageManager;
import android.support.annotation.NonNull;
import android.support.v4.app.ActivityCompat;
import android.support.v4.content.ContextCompat;
import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;

import com.example.francis.demo.R;

public class RuntimePermissionActivity extends AppCompatActivity {
    private final int REQUEST_CODE_CALL_PHONE = 1;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_runtime_permission);

        findViewById(R.id.call_button).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                if (ContextCompat.checkSelfPermission(RuntimePermissionActivity.this, Manifest.permission.CALL_PHONE) == PackageManager.PERMISSION_GRANTED) {
                    //æ‰“ç”µè¯é€»è¾‘åœ¨å“ªé‡Œå†™
                } else {
                    if (ActivityCompat.shouldShowRequestPermissionRationale(RuntimePermissionActivity.this,Manifest.permission.CALL_PHONE)) {
                        //å±•ç¤ºä½ ç»™ç”¨æˆ·çš„è§£é‡Šï¼Œè¿™ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä½ è§‰å¾—ä¸éœ€è¦æˆ–è€…ä½ ä¸æƒ³è§£é‡Šï¼Œé‚£å°±ä¸è¦è§£é‡Šäº†
                    } else {
                        //è¯·æ±‚æƒé™
                        ActivityCompat.requestPermissions(RuntimePermissionActivity.this,new String[]{Manifest.permission.CALL_PHONE}, REQUEST_CODE_CALL_PHONE);
                    }
                }
            }
        });
    }
    @Override
    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
        super.onRequestPermissionsResult(requestCode, permissions, grantResults);
        if (requestCode == REQUEST_CODE_CALL_PHONE) {
            if (grantResults[0] == PackageManager.PERMISSION_GRANTED) {
                //æ‰“ç”µè¯æƒé™è¢«æˆäºˆ
                //æ‰“ç”µè¯é€»è¾‘å†™è¿™é‡Œ
            } else {
                //ç”¨æˆ·æ‹’ç»äº†ä½ çš„æ‰“ç”µè¯æƒé™
            }
        }
    }
}
```
##å°ç»“
åˆ°äº†è¿™é‡Œï¼Œè¿è¡Œæ—¶æƒé™çš„ç”³è¯·æµç¨‹å’Œç»†èŠ‚å¤§å®¶åº”è¯¥å·²ç»éå¸¸æ¸…æ¥šäº†ï¼Œæ¥ä¸‹æ¥ä½ éœ€è¦åšçš„å°±æ˜¯è‡ªå·±å†™å†™çœ‹ï¼Œçœ‹çœ‹æºç ä»‹ç»ã€‚è™½ç„¶ä¹Ÿæœ‰å¾ˆå¤šåˆ«äººå†™å¥½çš„å¾ˆå¤šåº“å¯ä»¥ç›´æ¥æ¥è°ƒç”¨ï¼Œä½†æ˜¯ä¸‡å˜ä¸ç¦»å…¶å®—ï¼ŒçŸ¥é“æœ¬è´¨å†å»ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“å§ã€‚  
å¯¹äº†ï¼Œåˆ«å¿˜äº†åœ¨æ¸…å•æ–‡ä»¶ä¸­å£°æ˜è¿™äº›å±é™©æƒé™å“¦ğŸ˜...






